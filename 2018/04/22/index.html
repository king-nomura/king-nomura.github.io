<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.125.6"><meta name=author content><title>Hugoで日記を書くための自動化 - 野村政行の「堪忍袋の緒を締めろ！」</title>
<link rel=amphtml type=text/html href=https://diary.a3size.com/amp/2018/04/22/><meta property="og:site_name" content=" 野村政行の「堪忍袋の緒を締めろ！」"><meta property="og:title" content="Hugoで日記を書くための自動化"><meta property="og:type" content="website"><meta property="og:locale" content="ja_JP"><meta property="og:app_id" content="361503227564013"><meta property="og:url" content="https://diary.a3size.com/2018/04/22/"><meta property="og:image" content="https://diary.a3size.com/images/ogp.png"><meta name=twitter:image content="https://diary.a3size.com/images/ogp.png"><meta name=description content="先日の日記に書いたように、BitBucketに日記をPUSHするとゴニョゴニョしてGitHub Pagesで公開されるという仕組みが完成した。..."><meta property="og:description" content="先日の日記に書いたように、BitBucketに日記をPUSHするとゴニョゴニョしてGitHub Pagesで公開されるという仕組みが完成した。..."><meta name=twitter:description content="先日の日記に書いたように、BitBucketに日記をPUSHするとゴニョゴニョしてGitHub Pagesで公開されるという仕組みが完成した。..."><link rel=alternate type=application/rss+xml title=" 野村政行の「堪忍袋の緒を締めろ！」" href=https://diary.a3size.com/index.xml><link rel="shortcut icon" href=https://diary.a3size.com/images/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css><link rel=stylesheet href=https://diary.a3size.com/css/main.min.css media=all><link rel=me href=https://fedibird.com/@king_nomura><link rel=me href=https://social.a3size.com/@king_nomura></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://diary.a3size.com/ class=nav-logo><img src=https://diary.a3size.com/images/title.svg alt=野村政行の「堪忍袋の緒を締めろ！」></a><ul class=nav-links><li><a href=/tags><i class="fas fa-tags"></i> Tags</a></li><li><a href=/about/><i class="fas fa-info-circle"></i> About</a></li></ul></nav></header><main class=content role=main><article class=article><span class=article-date><i class="fas fa-book"></i> 2018-04-22</span><h1 class=article-title>Hugoで日記を書くための自動化</h1><div class=article-content><p><a href=/2018/04/21/>先日の日記</a>に書いたように、BitBucketに日記をPUSHするとゴニョゴニョしてGitHub Pagesで公開されるという仕組みが完成した。</p><p>日記を一日分追加すると、その日の日記ページのHTMLができる。のみならず、トップページに直近5日分の日記が載っているのでそこも再生成。すると日記が一日分後ろに押し出されて、ページネーション（次のページ）があるのでその後ろのページ全部が再生成させる。また日記につけたタグから、そのタグのリストページも再生成される。結果、数百のファイルが再生成される。うわーお、無駄が多い。でもなぁ、日記を一日分ずつ読み込むのもちょっと馬鹿馬鹿しい。まあそれはともかく、自動的にhtmlは作れるようになった。</p><p>では次は日記を新規作成するところだ。コマンドラインから <code>Hugo new ファイル名</code> でページのひな形が書き込まれたMarkdownファイルが完成する。これは楽チン……、と思いたいところだがもっと楽にしたい。</p><p>Automatorを使って、例えば以下のような感じのシェルスクリプトをアプリ化（というかアイコン化）して、ボタン一発で今日の日記を作ってエディタを開く。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=s1>&#39;Hugoの作業ディレクトリ&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># この例では年別にファイルを格納したいので、post/YYYYディレクトリを作成している</span>
</span></span><span class=line><span class=cl><span class=nv>targetYear</span><span class=o>=</span><span class=sb>`</span>date +<span class=s2>&#34;%Y&#34;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$targetYear</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 日付からファイル名を生成する。この例では post/YYYY/YYYY-MM-DD.mfd</span>
</span></span><span class=line><span class=cl><span class=nv>targetDate</span><span class=o>=</span><span class=sb>`</span>date +<span class=s2>&#34;%Y-%m-%d&#34;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=nv>targetFile</span><span class=o>=</span><span class=s2>&#34;post/</span><span class=nv>$targetYear</span><span class=s2>/</span><span class=nv>$targetDate</span><span class=s2>.md&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当該ファイルがなければ新規作成</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> ! -e <span class=s2>&#34;content/</span><span class=nv>$targetFile</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  /usr/local/bin/hugo new <span class=nv>$targetFile</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># この例ではアプリを指定せずにファイルを開く</span>
</span></span><span class=line><span class=cl>open <span class=s2>&#34;content/</span><span class=nv>$targetFile</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>これで、日記を書くところまでアイコンクリック一回でだけで進められる。</p><p>本当は、日記を書き終えたあともcommitとpushをアイコンクリック一回でやりたいが、エラー処理とか連打時の動作とか考えるとちょっと面倒そうなので、いったんここまでとして、今日記を書いているこのファイルをこのあと手動でcommitしてpushすることにする。</p><p>……コミット時のメッセージが日本語だとうまく動かない？</p></div><hr><ul class=article-taxonomy><li><i class="fas fa-tags"></i> <a href=/tags/a3size>a3size</a><a href=/tags/pc>PC</a></li></ul></article></main><ul class=page-links><li><a href=https://diary.a3size.com/2018/04/21/ aria-label=Previous><span aria-hidden=true><i class="fas fa-angle-left"></i> 前へ</span></a></li><li><a href=https://diary.a3size.com/2018/04/24/ aria-label=Next><span aria-hidden=true>次へ <i class="fas fa-angle-right"></i></span></a></li></ul><footer class=footer><ul class=footer-links><li><a href=https://social.a3size.com/@king_nomura target=_blank rel=noopener>ActivityPub</a></li><li><a href target=_blank rel=noopener>rss</a></li><li><a href=https://github.com/king-nomura target=_blank rel=noopener><i class="fab fa-github"></i> GitHub</a></li><li><a href=https://www.facebook.com/nomura.masayuki target=_blank rel=noopener><i class="fab fa-facebook-f"></i> Facebook</a></li></ul><p><small class=footer-copyright>author: nomura masayuki</small></p></footer></div></body></html>