<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.150.0"><meta name=author content="野村政行"><title>しつこいけれど、また自動化の話 - 野村政行の「堪忍袋の緒を締めろ！」</title><link rel=amphtml type=text/html href=https://diary.a3size.com/amp/2018/05/22/><meta property="og:site_name" content=" 野村政行の「堪忍袋の緒を締めろ！」"><meta property="og:title" content="しつこいけれど、また自動化の話"><meta property="og:type" content="website"><meta property="og:locale" content="ja_JP"><meta property="og:app_id" content="361503227564013"><meta property="og:url" content="https://diary.a3size.com/2018/05/22/"><meta property="og:image" content="https://diary.a3size.com/images/ogp.png"><meta name=twitter:image content="https://diary.a3size.com/images/ogp.png"><meta name=description content="以前書いたように、この日記はMarkdown形式のテキストファイルをBitBucketのレポジトリにPUSHすると、CIサービスであるWerckerがWebhookされ、Hugoによってhtmlファイルを生成して、そのhtmlファイルをGitHub PagesにPUSHしている。
その、日記用Markdownファイルを生成するスクリプトはAutomatorで書いた。これから、そのMarkdownファイル(拡張子は.md)を右クリックして「サービス」メニューからgitコミットするスクリプトのテストを行う。
..."><meta property="og:description" content="以前書いたように、この日記はMarkdown形式のテキストファイルをBitBucketのレポジトリにPUSHすると、CIサービスであるWerckerがWebhookされ、Hugoによってhtmlファイルを生成して、そのhtmlファイルをGitHub PagesにPUSHしている。
その、日記用Markdownファイルを生成するスクリプトはAutomatorで書いた。これから、そのMarkdownファイル(拡張子は.md)を右クリックして「サービス」メニューからgitコミットするスクリプトのテストを行う。
..."><meta name=twitter:description content="以前書いたように、この日記はMarkdown形式のテキストファイルをBitBucketのレポジトリにPUSHすると、CIサービスであるWerckerがWebhookされ、Hugoによってhtmlファイルを生成して、そのhtmlファイルをGitHub PagesにPUSHしている。
その、日記用Markdownファイルを生成するスクリプトはAutomatorで書いた。これから、そのMarkdownファイル(拡張子は.md)を右クリックして「サービス」メニューからgitコミットするスクリプトのテストを行う。
..."><link rel=alternate type=application/rss+xml title=" 野村政行の「堪忍袋の緒を締めろ！」" href=https://diary.a3size.com/index.xml><link rel="shortcut icon" href=https://diary.a3size.com/images/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css><link rel=stylesheet href=https://diary.a3size.com/css/main.min.css media=all><link rel=me href=https://fedibird.com/@king_nomura><link rel=me href=https://social.a3size.com/@king_nomura></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://diary.a3size.com/ class=nav-logo><img src=https://diary.a3size.com/images/title.svg alt=野村政行の「堪忍袋の緒を締めろ！」></a><ul class=nav-links><li><a href=/tags/><i class="fas fa-tags"></i> Tags</a></li><li><a href=/about/><i class="fas fa-info-circle"></i> About</a></li></ul></nav></header><main class=content role=main><article class=article><span class=article-date><i class="fas fa-book"></i> 2018-05-22</span><h1 class=article-title>しつこいけれど、また自動化の話</h1><div class=article-content><p><a href=/2018/04/21/>以前書いた</a>ように、この日記はMarkdown形式のテキストファイルを<a href=https://bitbucket.org/>BitBucket</a>のレポジトリにPUSHすると、CIサービスである<a href=http://www.wercker.com>Wercker</a>がWebhookされ、<a href=https://gohugo.io>Hugo</a>によってhtmlファイルを生成して、そのhtmlファイルを<a href=https://pages.github.com>GitHub Pages</a>にPUSHしている。</p><p>その、日記用Markdownファイルを生成するスクリプトはAutomatorで書いた。これから、そのMarkdownファイル(拡張子は.md)を右クリックして「サービス」メニューからgitコミットするスクリプトのテストを行う。</p><p>まずファイルをaddして、それからcommit。gitコマンド的には、いちどaddされているファイルをもう一回addしても問題ないようなので、何度でも実行可能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=o>{</span>日記gitのルートディレクトリ<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>currentDate</span><span class=o>=</span><span class=sb>`</span>date +%FT%T%z <span class=p>|</span> sed -e <span class=s1>&#39;s/\(.\{22\}\)/\1:/&#39;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=k>for</span> f in <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>	<span class=nv>ext</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=si>${</span><span class=nv>f</span><span class=p>##*.</span><span class=si>}</span> <span class=p>|</span> sed <span class=s2>&#34;y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/&#34;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=o>[</span> <span class=nv>$ext</span> <span class=o>=</span> <span class=s2>&#34;md&#34;</span> -a ! -d <span class=nv>$f</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>		sed -i <span class=s1>&#39;&#39;</span> -e <span class=s1>&#39;s/^date: &#34;[^&#34;]*&#34;$/date: &#34;&#39;</span><span class=nv>$currentDate</span><span class=s1>&#39;&#34;/g&#39;</span> <span class=nv>$f</span>
</span></span><span class=line><span class=cl>    /usr/bin/git add <span class=nv>$f</span>
</span></span><span class=line><span class=cl>	<span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/usr/bin/git commit -m <span class=s1>&#39;[add|mod] dayly post&#39;</span>
</span></span></code></pre></div><p>日記の中の日付(日記の更新日)はcommitした瞬間の日付に上書きしている。日付フォーマットが<code>date</code>コマンドのままだとおかしくなる（タイムゾーン「+0900」ではダメで、「+09:00」だとOK）ので強引に変更している、など。強引でよろしくない感じのスクリプトだが、まあとりあえず動く。</p></div><hr><ul class=article-taxonomy><li><i class="fas fa-tags"></i> <a href=/tags/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88>インターネット</a><a href=/tags/a3size>a3size</a></li></ul></article></main><ul class=page-links><li><a href=https://diary.a3size.com/2018/05/12/ aria-label=Previous><span aria-hidden=true><i class="fas fa-angle-left"></i> 前へ</span></a></li><li><a href=https://diary.a3size.com/2018/06/24/ aria-label=Next><span aria-hidden=true>次へ <i class="fas fa-angle-right"></i></span></a></li></ul><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank><i class="fas fa-rss"></i> RSSフィード</a></li><li><a href=https://social.a3size.com/users/king_nomura target=_blank rel=noopener>ActivityPub</a></li><li><a href=https://github.com/king-nomura target=_blank rel=noopener><i class="fab fa-github"></i> GitHub</a></li><li><a href=https://www.facebook.com/nomura.masayuki target=_blank rel=noopener><i class="fab fa-facebook-f"></i> Facebook</a></li></ul><p><small class=footer-copyright>author: nomura masayuki</small></p></footer></div></body></html>